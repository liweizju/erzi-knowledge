# 二子知识站 · 变更日志

> 记录每次建站的重要更新和改进。

---

## 2026-02-23 - 阅读体验与数据功能增强（T38/T60-T63）

### 📊 数据统计与追踪

- **T38: 访问统计展示（轻量版）**
  - 客户端访问统计（基于 localStorage）
  - 热门文章 TOP 5 榜单
  - 总访问量、已读文章、收藏文章统计面板
  - 后续可平滑升级为 Cloudflare Analytics API 版本

### 🔍 搜索体验优化

- **T60: 搜索结果高亮**
  - 搜索结果中自动高亮匹配的关键词
  - 标题和摘要都支持高亮显示
  - 支持暗色模式

### 📥 导出与保存

- **T61: 文章导出功能**
  - 详情页新增导出按钮
  - 一键下载 Markdown 文件
  - 包含完整元数据头部（标题、日期、分类、标签）

### 📖 阅读进度

- **T62: 阅读进度保存**
  - 自动记录每篇文章的滚动位置
  - 下次打开时自动恢复到上次阅读位置
  - 节流保存机制（每 2 秒）避免频繁写入

### 📑 导航优化

- **T63: 文章目录折叠**
  - 详情页 TOC 支持折叠/展开
  - 折叠后标题竖排显示，节省空间
  - 自动记住折叠状态

---

## 2026-02-22 - P0 稳定读者产品化落地（T53-T58）

### 🎯 首页定位与转化路径

- **T53: 首页价值主张重构**
  - 首屏新增明确定位：`给 AI 产品人的每日决策情报`
  - 补充副标题（筛噪音 + 给判断 + 给行动）和双 CTA（订阅 / 起步包）
  - 首页从“文章列表”升级为“价值主张 + 内容入口”

- **T55: 每周决策备忘录入口**
  - 首页新增「本周决策备忘录」卡片（标题、发布时间、结论、行动项）
  - 支持一键进入完整内容，配合 RSS 订阅入口形成固定节奏

- **T57: 订阅入口与回访机制**
  - 顶部导航新增订阅按钮，新增 `#/subscribe` 订阅页
  - 详情页底部新增“每周决策备忘录”CTA
  - 订阅页提供频率、价值、隐私承诺与 RSS 复制能力

### 🧭 新读者入门与留存看板

- **T54: 新读者起步包**
  - 新增 `#/start-here` 页面
  - 自动精选 10 篇代表内容，附“为什么值得看”的阅读理由
  - 形成入门→进阶→决策的快速阅读路径

- **T58: 留存指标面板（轻量）**
  - 首页新增 4 项核心指标看板（7日回访率/订阅转化率/周报打开率/收藏率）
  - 新增数据源：`public/data/retention-metrics.json`
  - Service Worker 核心缓存加入该数据文件，确保离线可读

### 🧩 决策模板能力升级（T56）

- 列表卡片优先显示 `30秒结论`
- 详情页新增“今日可执行动作”区块
- `build-data.js` 新增 `quickConclusion` 与 `actionItems` 提取并输出到索引数据
- `build-check.js` 新增模板覆盖率检查（告警不阻断）
- 新增 `scripts/backfill-action-items.js`，对最近样本缺失动作段文章执行半自动补齐
- 兼容提取规则已覆盖：
  - `30秒结论`、`TL;DR`、`关键判断`、文首引用句
  - 含前缀的“行动建议”章节（如“后续行动建议”“五、行动建议：...”）
  - 嵌套行动章节与策略标题（如“潜在产品方向”“战略建议”“对XX建议”）

### ✅ 验收记录

- `npm run build`：通过（258 篇数据重新生成）
- `npm run build:check`：通过（有警告）
  - 30秒结论覆盖率：100.0%（最近 20 篇）
  - 可执行动作覆盖率：100.0%（最近 20 篇，已达 T56 验收目标）
  - 体积告警：CSS/JS/index.json 略超预算（不阻断）

---

## 2026-02-20 - T40 全文搜索上线与构建修复

### 🔍 全文搜索（Lunr）上线

#### T40: 全文搜索优化
- 新增构建产物：`public/data/search-index.json`（并同步到 `dist/data/search-index.json`）
- 前端改为优先使用 Lunr 索引搜索，索引不可用时自动降级到标题/摘要/标签匹配
- 中文检索采用双字切分（bigram）策略，降低单字匹配噪音

### 🛠 构建稳定性修复

- 移除不兼容的 `nodejieba/lunr-languages` 接入方式，避免 `nodejieba.cut is not a function` 构建错误
- `npm run build` 已恢复通过（2026-02-20 验证）
- 当前文章规模更新为 **188 篇**

---

## 2026-02-19 (晚间) - 精确化与体验优化

### 📊 精确化改进

#### T41: 文章字数/阅读时间精确化
- **精确统计字数**：
  - 中文字符单独统计（每个算1字）
  - 英文单词单独统计（每个词算1字）
  - 代码块权重 0.3（阅读速度慢）
  - 图片每张算 50 字
- **精确阅读时间**：
  - 中文：300 字/分钟
  - 英文：200 词/分钟
  - 混合内容按比例计算
- **数据输出**：新增 `chineseCount` 和 `englishCount` 字段

### 📱 PWA 离线支持

#### T42: PWA 离线功能
- **Web App 清单**：添加 manifest.json
  - 应用名称、图标、主题色
  - 支持添加到主屏幕
  - 快捷方式：随机探索
- **Service Worker 缓存策略**：
  - 静态资源（JS/CSS）：缓存优先
  - 数据文件（文章）：网络优先，失败回缓存
  - 访问过的文章自动缓存
- **离线阅读**：已访问内容可离线查看

### 📱 移动端体验优化

#### T44: 移动端预览卡片
- **点击展开预览**：
  - 第一次点击：展开卡片，显示完整摘要 + 字数 + 阅读时间
  - 第二次点击：进入详情页
- **桌面端保持不变**：hover 显示预览浮层
- **智能关闭**：切换分类/搜索时自动关闭展开
- **提升体验**：移动端也能快速判断文章相关性

---

## 2026-02-19 - 性能与体验大升级

### 🚀 核心优化

#### T20: 数据拆分——按需加载文章内容
- **首屏性能提升 95%**：加载数据量从 ~1-2MB 降至 ~80KB
- `build-data.js` 现在生成：
  - `public/data/index.json`：仅 metadata
  - `public/data/notes/{id}.md`：每篇文章完整内容
  - `data-generated.js`：轻量化（不含 content）
- 详情页打开时 `fetch('/data/notes/{id}.md')` 按需加载
- 搜索基于 title/summary/tags（牺牲全文搜索换取性能）
- 175 篇文章，首屏加载速度显著提升

### 📚 功能增强

#### T26: 文章系列功能
- 支持在 markdown frontmatter 中标记 `series: "系列名"`
- 详情页显示系列信息：名称 + 进度（第 N / M 篇）
- 系列导航：上一篇/下一篇按钮
- 渐进增强：无 series 标记的文章不受影响

### 🎨 体验优化

#### T35: 页面切换动画
- 容器淡入动画（fadeIn）
- 详情页滑入动画（slideInRight）
- 列表页切换时淡入淡出
- 使用纯 CSS @keyframes 实现（性能优异）

#### T36: 文章预览卡片
- 列表页 hover 文章卡片显示预览浮层（桌面端）
- 预览内容：完整 summary + 所有标签 + 字数/阅读时间
- 纯 CSS 实现，移动端自动隐藏
- 帮助用户快速判断文章相关性

### 📊 统计

- **任务完成数**：4 个（T20, T26, T35, T36）
- **代码行数变化**：+400 行
- **构建大小**：index.js ~1.1MB（包含 highlight.js）

---

## 2026-02-18 - 功能补全

### 已完成任务

- **T24: 时间线视图** - 按月份分组展示知识积累轨迹
- **T29: 标签云页面** - 可视化所有标签，支持点击筛选
- **T33: 阅读历史** - 记录已读文章，显示阅读时间
- **T34: 收藏功能** - 收藏感兴趣的文章，支持收藏列表
- **T23: 暗色模式** - 跟随系统偏好 + 手动切换

---

## 2026-02-17 - 交互重构

### 核心改进

- **T14: 分类 Tab 导航** - 取代笨重的标签侧栏
- **T15: 笔记列表分页** - 每页 20 篇，优化长列表体验
- **T16: 首页布局精简** - 去除杂乱区块，统一为 Tab + 列表
- **T17: 笔记卡片优化** - 显示阅读时间 + 内联标签
- **T18: 详情页 TOC 移到右侧** - 符合主流阅读习惯
- **T19: 详情页阅读体验增强** - 进度条 + 阅读时间 + 快捷键
- **T21: 移动端适配优化** - Tab 横向滚动 + sticky header

### 功能补全

- **T22: 键盘导航** - j/k 上下篇，/ 聚焦搜索，Esc 返回
- **T27: 随机探索** - 随机跳转一篇文章
- **T28: 返回顶部按钮** - 滚动超过 500px 后显示
- **T30: 文章分享** - 复制链接功能
- **T31: 打印优化** - @media print 样式
- **T32: 404 页面** - 友好的错误提示

---

## 2026-02-17 - 基础建设

- **T01: URL 路由系统** - 基于 hash 的路由
- **T02: 首页重设计** - 突出洞见报告
- **T03: Open Graph meta 标签** - 社交分享优化
- **T04: About 页面** - 介绍二子
- **T05: RSS Feed** - 订阅功能
- **T06: 文章内搜索** - 实时搜索
- **T07: Sitemap 生成** - SEO 优化
- **T09: insights 分类样式补全** - amber 色条
- **T10: 文章目录导航** - TOC 侧边栏
- **T12: 代码块语法高亮** - highlight.js
- **T13: 相关文章推荐** - 同分类最近 3 篇

---

## 初始版本

- Vue 3 + Vite + marked 技术栈
- GitHub Pages (gh-pages 分支) 部署
- 基础的 markdown 渲染
- 分类系统：tech/inspiration/reading/reflection/insights/diary
